# 03 排序資料

## (1) 以國文排序scores, 由小到大  .ref('scores').orderByChild('國文')

```
<測試>
   |__ index.js
   |
   |__ <lib>
         |__ db.js  
```

### (1-1) 資料庫的規則

```javascript
{
    /* Visit https://firebase.google.com/docs/database/security to learn more about security rules. */
    "rules": {
        ".read": true,
        ".write": true,
        "scores": {
           ".indexOn": ["國文"]
        } 
    }  
}
```



### (1-2) db.js

```javascript
var firebase = require('firebase');
 
//------------------------
// firebase設定
//------------------------
var config =  {
    apiKey: "(自己在firebase的資料)",
    authDomain: "(自己在firebase的資料)",
    databaseURL: "(自己在firebase的資料)",
    projectId: "(自己在firebase的資料)",
    storageBucket: "(自己在firebase的資料)",
    messagingSenderId: "(自己在firebase的資料)"
};

//----------------------------
// 匯出firebase資料庫物件
//----------------------------
firebase.initializeApp(config);
module.exports = firebase.database();
```



### (1-3) index.js

```javascript
//----------------------------
// 引用db.js
//----------------------------
var myDB = require('./lib/db.js');

//----------------------------
// 讀入一個Collection的函式
//----------------------------
function readData(collections){    
    return new Promise(function(resolve, reject){		
        myDB.ref(collections).orderByChild('國文').once('value').then(snapshot => {				
            if (!snapshot.exists()) {
                //回傳空資料
                resolve([]);
            }else{					
                results=[]; 
				
                snapshot.forEach(childSnapshot => {
                    var obj={};
                    key = childSnapshot.key;
                    var value = childSnapshot.val();
                    obj[key] = value;
							
                    results.push(obj);
                });	
				
                //回傳讀出的資料		
                resolve(results);				
            }
        });	
    });
}


//----------------------------
// 讀入資料
//----------------------------
readData('scores').then(results => {
    results.forEach(doc => {
        console.log(Object.keys(doc)[0]);
        console.log(Object.values(doc)[0]);
        console.log();
    });
});	
```



## (2) 排序國文成績, 由大到小 (以push()及pop()完成)

### index.js

```javascript
//----------------------------
// 引用db.js
//----------------------------
var myDB = require('./lib/db.js');

//----------------------------
// 讀入一筆資料的函式
//----------------------------
function readData(dataset){    
    return new Promise(function(resolve, reject){
        //存回傳資料
        results=[];       
		
        myDB.ref(dataset).orderByChild('國文').once('value')
            .then(snapshot => {
                if (!snapshot.exists()) {
                    //回傳空資料
                    resolve([]);
                }else{	
                    snapshot.forEach(childSnapshot => {
                        var obj={};
                        key = childSnapshot.key;
                        var value = childSnapshot.val();
                        obj[key] = value;
								
                        results.push(obj);
                    });	
                }

                //儲存反向順序結果
                reverseResults=[];
				
                //以反向順序取出結果
                while(data = results.pop()){
                    reverseResults.push(data);				
                }
				
                //回傳反向的資料		
                resolve(reverseResults);
            })
            .catch(error => {
                //回傳錯誤	    
                reject(error);
            });		
	});
}


//----------------------------
// 讀入資料
//----------------------------
readData('scores')
    .then(results => {
        console.log(results);		
    })
    .catch(error => {
        console.log('執行錯誤! '+error);
    });
```


## (3) 由學生所屬的學校, 再其內的縣市別排序  .orderByChild('school/city')

### index.js

```javascript
//----------------------------
// 引用db.js
//----------------------------
var myDB = require('./lib/db.js');

//----------------------------
// 讀入一筆資料的函式
//----------------------------
function readData(dataset){    
    return new Promise(function(resolve, reject){
        //存回傳資料
        results=[];       
		
        myDB.ref(dataset).orderByChild('school/city').once('value')
            .then(snapshot => {
                if (!snapshot.exists()) {
                    //回傳空資料
                    resolve([]);
                }else{	
                    snapshot.forEach(childSnapshot => {
                        var obj={};
                        key = childSnapshot.key;
                        var value = childSnapshot.val();
                        obj[key] = value;
								
                        results.push(obj);
                    });	
                }
				
                //回傳讀出的資料		
                resolve(results);
            })
            .catch(error => {
                //回傳錯誤	    
                reject(error);
            });		
	});
}


//----------------------------
// 讀入資料
//----------------------------
readData('students')
    .then(results => {
        console.log(results);		
    })
    .catch(error => {
        console.log('執行錯誤! '+error);
    });
```


