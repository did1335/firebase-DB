# 02 讀取資料

## (1) 讀一筆資料

```
<測試>
   |__ index.js
   |
   |__ <lib>
         |__ db.js  
```


### (1-1) db.js

```javascript
var firebase = require('firebase');
 
//------------------------
// firebase設定
//------------------------
var config =  {
    apiKey: "(自己在firebase的資料)",
    authDomain: "(自己在firebase的資料)",
    databaseURL: "(自己在firebase的資料)",
    projectId: "(自己在firebase的資料)",
    storageBucket: "(自己在firebase的資料)",
    messagingSenderId: "(自己在firebase的資料)"
};

//----------------------------
// 匯出firebase資料庫物件
//----------------------------
firebase.initializeApp(config);
module.exports = firebase.database();
```



### (1-2) index.js

```javascript
//----------------------------
// 引用db.js
//----------------------------
var myDB = require('./lib/db.js');


//----------------------------
// 讀入一筆資料的函式
//----------------------------
function readData(stuNo){	
    return myDB.ref('/students/' + stuNo).once('value')
    .then(snapshot => {
        if (!snapshot.exists()) {
            console.log("找不到資料");
        }else{	
            var name = snapshot.val().name;
            var gender = snapshot.val().gender;
            console.log(name);	
            console.log(gender);
        }			
    })
    .catch(error => {
        console.log('錯誤');
    });
}

//----------------------------
// 讀入資料
//----------------------------
readData('120001');
```



## (2) 讀一個資料集的資料

### index.js

```javascript
//----------------------------
// 引用db.js
//----------------------------
var myDB = require('./lib/db.js');

//----------------------------
// 讀入一筆資料的函式
//----------------------------
function readData(dataset){    
    return new Promise(function(resolve, reject){
        //存回傳資料
        results=[];       
		
        myDB.ref(dataset).orderByKey().once("value")
            .then(snapshot => {
                if (!snapshot.exists()) {
                    //回傳空資料
                    resolve([]);
                }else{	
                    snapshot.forEach(childSnapshot => {
                        var obj={};
                        key = childSnapshot.key;
                        var value = childSnapshot.val();
                        obj[key] = value;
								
                        results.push(obj);
                    });	
                }
                //回傳讀出的資料		
                resolve(results);
            })
            .catch(error => {
                //回傳錯誤	    
                reject(error);
            });		
	});
}


//----------------------------
// 讀入資料
//----------------------------
readData('students')
    .then(results => {
        console.log(results);		
    })
    .catch(error => {
        console.log('執行錯誤! '+error);
    });
```



## (3) 讀一筆資料及其內的子資料

### index.js

```javascript
//----------------------------
// 引用db.js
//----------------------------
var myDB = require('./lib/db.js');

//----------------------------
// 讀入一筆資料的函式
//----------------------------
function readData(stuNo){	
    return myDB.ref('/students/' + stuNo).once('value')
        .then(snapshot => {
            if (!snapshot.exists()) {
                console.log("找不到資料");
            }else{	
                //從快照中取出資料值
                var data = snapshot.val();		
                var name = snapshot.val().name;
                var gender = snapshot.val().gender;
			
                console.log(data);
                console.log(name);	
                console.log(gender);

			
                //從物件中取出key/value
                for(key in data){
                    console.log(key);
                    console.log(data[key]);
                    console.log('---');
                }			
			
			
                //從快照中, 取出子物件(也是一個快照)
                var school = snapshot.child('school');	
                if (!school.exists()) {
                    console.log("找不到學校資料");
                }else{			
                    for(key in school.val()){
                        console.log(key);
                        console.log(school.val()[key]);
                        console.log('---');
                    }
                }	
            }			
        })
        .catch(error => {
            console.log('錯誤');
        });
}

//----------------------------
// 讀入資料
//----------------------------
readData('120001');
```
